(function(){"use strict";let m=new Map;const h="https://w3c.github.io/wot-binding-templates/bindings/protocols/modbus/modbus.schema.json",r="https://w3c.github.io/wot-binding-templates/bindings/protocols/coap/coap.schema.json",u="https://w3c.github.io/wot-binding-templates/bindings/protocols/http/http.schema.json",p="https://w3c.github.io/wot-binding-templates/bindings/protocols/mqtt/mqtt.schema.json";let l;function d(){const t=new Map;t.set("modbus",h),t.set("modbus+tcp",h),t.set("modbus+udp",h),t.set("coap",r),t.set("coap+tcp",r),t.set("coap+ws",r),t.set("coaps",r),t.set("coaps+tcp",r),t.set("coaps+ws",r),t.set("http",u),t.set("https",u),t.set("mqtt",p),t.set("mqtt+tcp",p),t.set("mqtt+ssl",p),t.set("mqtt+ws",p),l=t}function b(t){if(!t)return[];let e=typeof t;if(e!=="string"&&t.constructor!==Array)return[];if(e==="string")return[t];let n=[];for(let o=0;o<t.length;o++){let s=t[o];if(!(!(typeof s=="object"&&!Array.isArray(s)&&s!==null)&&typeof s!="string")){if(typeof s=="string"){n.push(s);continue}for(const c in s){if(!Object.prototype.hasOwnProperty.call(s,c))continue;let a=s[c];typeof a=="string"&&n.push(a)}}}return n}function w(t){if(!Object.prototype.hasOwnProperty.call(t,"base"))return[];let e=t.base,n;try{n=new URL(e)}catch(c){return console.error(`base url is invalid: ${c}`),[]}l===void 0&&d();let o=n.protocol.substring(0,n.protocol.length-1);console.debug(`cheking binding schema map for ${o}...`);let s=l.get(o);return s?[s]:[]}async function y(t){let e=new Map;for(let n=0;n<t.length;n++){let o=t[n],s=m.get(o);if(s!==void 0){console.debug(`using cached schema for ${o}`),e.set(o,s);continue}try{const c=new URL(o),i=await(await fetch(c)).json();e.set(o,i)}catch{e.set(o,void 0)}}return e}function S(t){t.forEach(function(e,n){e!==void 0&&m.set(n,e)})}const f=t=>!(typeof t=="object"&&!Array.isArray(t)&&t!==null)||!Object.prototype.hasOwnProperty.call(t,"@type")?!1:t["@type"].indexOf("tm:ThingModel")>-1;let g=new Map;const U="https://raw.githubusercontent.com/thingweb/thingweb-playground/%40thing-description-playground/web%401.0.0/packages/playground-core/td-schema.json",j="https://raw.githubusercontent.com/w3c/wot-thing-description/main/validation/tm-json-schema-validation.json";self.onmessage=async t=>{if(!(typeof t.data=="string"||t.data instanceof String))return;let e={};try{e=JSON.parse(t.data)}catch(i){console.debug(`ran into error while parsing TD: ${i}`),postMessage(g);return}if(typeof e!="object"||e.constructor===Array||!e)return;let n=f(e)?j:U,o=b(e["@context"]),s=w(e),c=[n,...o,...s];f&&(c=c.filter(i=>i!=="https://www.w3.org/2019/wot/td/v1"));let a=await y(c);S(a),g=a,postMessage(a),console.debug("schema worker sent response...")}})();
