(function(){"use strict";let m=new Map;const p="https://w3c.github.io/wot-binding-templates/bindings/protocols/modbus/modbus.schema.json",i="https://w3c.github.io/wot-binding-templates/bindings/protocols/coap/coap.schema.json",u="https://w3c.github.io/wot-binding-templates/bindings/protocols/http/http.schema.json",h="https://w3c.github.io/wot-binding-templates/bindings/protocols/mqtt/mqtt.schema.json";let l;function d(){const t=new Map;t.set("modbus",p),t.set("modbus+tcp",p),t.set("modbus+udp",p),t.set("coap",i),t.set("coap+tcp",i),t.set("coap+ws",i),t.set("coaps",i),t.set("coaps+tcp",i),t.set("coaps+ws",i),t.set("http",u),t.set("https",u),t.set("mqtt",h),t.set("mqtt+tcp",h),t.set("mqtt+ssl",h),t.set("mqtt+ws",h),l=t}function b(t){if(!t)return[];let e=typeof t;if(e!=="string"&&t.constructor!==Array)return[];if(e==="string")return[t];let n=[];for(let o=0;o<t.length;o++){let s=t[o];if(!(!(typeof s=="object"&&!Array.isArray(s)&&s!==null)&&typeof s!="string")){if(typeof s=="string"){n.push(s);continue}for(const a in s){if(!s.hasOwnProperty(a))continue;let c=s[a];typeof c=="string"&&n.push(c)}}}return n}function w(t){if(!t.hasOwnProperty("base"))return[];let e=t.base,n;try{n=new URL(e)}catch(a){return console.error(`base url is invalid: ${a}`),[]}l===void 0&&d();let o=n.protocol.substring(0,n.protocol.length-1);console.debug(`cheking binding schema map for ${o}...`);let s=l.get(o);return s?[s]:[]}async function y(t){let e=new Map;for(let n=0;n<t.length;n++){let o=t[n],s=m.get(o);if(s!==void 0){console.debug(`using cached schema for ${o}`),e.set(o,s);continue}try{const a=new URL(o),r=await(await fetch(a)).json();e.set(o,r)}catch{e.set(o,void 0)}}return e}function S(t){t.forEach(function(e,n){e!==void 0&&m.set(n,e)})}const f=t=>!(typeof t=="object"&&!Array.isArray(t)&&t!==null)||!Object.prototype.hasOwnProperty.call(t,"@type")?!1:t["@type"].indexOf("tm:ThingModel")>-1;let g=new Map;const U="https://raw.githubusercontent.com/thingweb/thingweb-playground/%40thing-description-playground/web%401.0.0/packages/playground-core/td-schema.json",M="https://raw.githubusercontent.com/w3c/wot-thing-description/main/validation/tm-json-schema-validation.json";self.onmessage=async t=>{if(!(typeof t.data=="string"||t.data instanceof String))return;let e={};try{e=JSON.parse(t.data)}catch(r){console.debug(`ran into error while parsing TD: ${r}`),postMessage(g);return}if(typeof e!="object"||e.constructor===Array||!e)return;let n=f(e)?M:U,o=b(e["@context"]),s=w(e),a=[n,...o,...s];f&&(a=a.filter(r=>r!=="https://www.w3.org/2019/wot/td/v1"));let c=await y(a);S(c),g=c,postMessage(c),console.debug("schema worker sent response...")}})();
